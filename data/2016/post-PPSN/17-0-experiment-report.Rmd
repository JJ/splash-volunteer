---
title: "Volunteer computing using NodIO: experiment report"
author: "J. J. Merelo"
date: "18 de marzo de 2016"
output: html_document
---

```{r setup, include=FALSE,cache=FALSE,echo=FALSE}

library("ggplot2")
library("RColorBrewer")
experiment.data <- data.frame(Experiment=character(),
                              milliseconds=character(),                           
                              IPs=character(), 
                              actualIPs=character(),
                              PUTs=character(),
                              actualPUTs=character(),
                              PUTratio = character(),
                              PUTsIP =character(),
                              entropy=character(),
                              cacheEntropy=character())

these.experiments <- c("17-0")

experiment.aggregates <- data.frame(Experiment=character(),
                                    milliseconds=character(),
                                    IPs=character(),
                                    actualIPs = character(),
                                    PUTs = character(),
                                    actualPUTs = character(),
                                    count = character(),
                                    totalIPs = character(),
                                    PUTsIP = character(),
                                    entropy=character(),
                                    cacheEntropy=character())

experiment.aggregates.filtered = experiment.aggregates

ips.data <- data.frame(Experiment=character(),                      
                       PUTs=character(),
                       reboots=character(),
                       idu=character(),
                       idx=character())

ips.aggregates <- data.frame(Experiment=character(),
                             PUTs = character(),
                             reboots = character(),
                             avgPUTs = character(),
                             avgreboots = character(),
                             totalIPs = character())

minutes.data <- data.frame(Experiment=character(),                      
                            minute=character(),
                            IPs=character(),
                            PUTs=character(),
                            updates=character(),
                            ratio=character())

seconds.data <- data.frame(Experiment=character(),                      
                            second=character(),
                            PUTs=character(),
                            updates=character(),
                            ratio=character())

for ( i in these.experiments ) {
    this.data <- read.csv(paste0("nodio-2016-3-",i,"_by_exp.csv"))

    this.ip.data <- read.csv(paste0("nodio-2016-3-",i,"_by_IP.csv"))
    this.len <- length(this.ip.data$PUTs)
    seq <- 1:this.len
    ips.data <- rbind(ips.data,
                      data.frame(Experiment=rep(i,length(this.ip.data$PUTs)),
                                 idu=seq,
                                 idx=seq/this.len,
                                 PUTs=as.integer(this.ip.data$PUTs),
                                 reboots=as.integer(this.ip.data$reboots))
                       )
    
    ips.aggregates <- rbind( ips.aggregates,
                            data.frame(Experiment=i,
                                       PUTs = median(this.ip.data$PUTs),
                                       reboots = median(this.ip.data$reboots),
                                       avgPUTs = mean(this.ip.data$PUTs),
                                       avgreboots = mean(this.ip.data$reboots),
                                       totalIPs =this.len )
                            )
    
    experiment.aggregates <- rbind( experiment.aggregates,
                                   data.frame( Experiment=i,                   
                                              milliseconds=median(as.integer(this.data$milliseconds)),
                                              IPs=median(as.integer(this.data$IPs)),
                                              actualIPs=median(as.integer(this.data$actualIPs)),
                                              PUTs=median(as.integer(this.data$PUTs)),
                                              actualPUTs=median(as.integer(this.data$actualPUTs)),
                                              PUTratio=median(as.integer(this.data$actualPUTs)/as.integer(this.data$PUTs)),
                                              count= length(this.data$IPs),
                                              totalIPs=this.len,
                                              PUTsIP=median(as.integer(this.data$PUTs)/as.integer(this.data$IPs)),
                                              entropy=median(this.data$entropy),
                                              cacheEntropy=median(this.data$cacheEntropy)
                                              )
                                   )
    
    experiment.data <- rbind( experiment.data,
                              data.frame( Experiment=rep(i, length(this.data$IPs)),                   
                                        milliseconds=as.integer(this.data$milliseconds),
                                        IPs=as.integer(this.data$IPs),
                                        actualIPs=as.integer(this.data$actualIPs),
                                        PUTs=as.integer(this.data$PUTs),
                                        actualPUTs=as.integer(this.data$actualPUTs),
                                        PUTsIP=as.integer(this.data$PUTs)/as.integer(this.data$IPs),
                                        entropy=as.numeric(this.data$entropy),
                                        cacheEntropy=as.numeric(this.data$cacheEntropy)
                                        )
                              )

    this.data <- this.data[this.data$actualPUTs>=16,]
    experiment.aggregates.filtered <- rbind( experiment.aggregates.filtered,
                                            data.frame( Experiment=i,                   
                                                       milliseconds=median(as.integer(this.data$milliseconds)),
                                                       IPs=median(as.integer(this.data$IPs)),
                                                       actualIPs=median(as.integer(this.data$actualIPs)),
                                                       PUTs=median(as.integer(this.data$PUTs)),
                                                       actualPUTs=median(as.integer(this.data$actualPUTs)),
                                                       count= length(this.data$IPs),
                                                       PUTsIP=median(as.integer(this.data$PUTs)/as.integer(this.data$IPs)),
                                                       entropy=median(this.data$entropy)
                                                       )
                                            )
    
    IPs <- read.csv(paste0("nodio-2016-3-",i,"_per_minute.csv"))
    IPs$minute <-  as.POSIXct(IPs$time, format="%Y-%m-%dT%H:%M")

    minutes.data <- rbind( minutes.data,
                          data.frame(Experiment=i,                      
                            minute=IPs$minute,
                            IPs=IPs$IPs,
                            PUTs=IPs$PUTs,
                            updates=IPs$updates,
                            ratio=IPs$updates/IPs$PUTs))
    
    seconds <- read.csv(paste0("nodio-2016-3-",i,"_per_second.csv"))
    seconds$second <-  as.POSIXct(seconds$time, format="%Y-%m-%dT%H:%M:%S")

    seconds.data <- rbind( seconds.data,
                          data.frame(Experiment=i,                      
                            second=seconds$second,
                            PUTs=seconds$PUTs,
                            updates=seconds$updates,
                            ratio=seconds$updates/seconds$PUTs))
}

```

#Abstract

This is the report on the experiment performed on the afternoon of March 17th and thereafter. Main change to the code base was the use of a single PUT request to interchange information with the pool. Main contributor to the volunteers was a [tweet by Randall Olson](https://twitter.com/randal_olson/status/710534806090682368) and its subsequent posting in [Reddit](https://twitter.com/PureValueLtd/status/710543530503102464).

#IPs

```{r experiment, cache=FALSE,echo=FALSE}
max <- max(experiment.data$IPs)
exp.palette <- colorRampPalette(brewer.pal(12,"Paired"))
ggplot(data=experiment.data)+geom_point(aes(x=milliseconds,y=entropy,size=PUTs,color=IPs))+scale_x_log10()+scale_y_log10()+scale_color_gradient(limits=c(1,max),low='red')
ggplot(data=experiment.data)+geom_point(aes(x=milliseconds,y=cacheEntropy,size=PUTs,color=IPs))+scale_x_log10()+scale_y_log10()+scale_color_gradient(limits=c(1,max),low='red')
ggplot(data=experiment.data)+geom_point(aes(x=entropy,y=cacheEntropy,size=PUTs,color=IPs))+scale_color_gradient(limits=c(1,max),low='red')
```

```{r timegraph, cache=FALSE,echo=FALSE}
ggplot(data=minutes.data, aes(x=minute,y=IPs))+ scale_x_datetime()+geom_line()+stat_smooth()
ggplot(data=minutes.data, aes(x=minute,y=ratio))+ scale_x_datetime()+geom_line()+stat_smooth()
ggplot(data=minutes.data, aes(x=minute,y=PUTs,color=ratio))+ scale_x_datetime()+geom_point()+stat_smooth()
ggplot(data=minutes.data)+geom_point(aes(x=IPs,y=PUTs,size=ratio,color=updates))

```

```{r secondgraph, cache=FALSE,echo=FALSE}
max <- max(seconds$PUTs)
this.palette <- colorRampPalette(brewer.pal(12,"Paired"))
ggplot(data=seconds.data, aes(x=second,y=ratio))+ scale_x_datetime()+geom_point(aes(color=factor(PUTs)))+scale_color_manual(values=this.palette(max))+stat_smooth()
ggplot(data=seconds.data, aes(x=second,y=PUTs,color=ratio))+ scale_x_datetime()+geom_point()+stat_smooth()


